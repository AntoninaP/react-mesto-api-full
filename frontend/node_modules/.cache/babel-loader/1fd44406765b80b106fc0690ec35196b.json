{"ast":null,"code":"import _toConsumableArray from\"/Users/oleg/Desktop/prakticum/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/oleg/Desktop/prakticum/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from\"react\";import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import ImagePopup from\"./ImagePopup\";import PopupWithForm from\"./PopupWithForm\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import Login from\"./Login\";import Register from\"./Register\";import InfoTooltip from\"./InfoTooltip\";import*as Auth from\"../utils/Auth\";import newApi from\"../utils/api\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import{Route,Switch,Redirect,useLocation,useHistory}from\"react-router-dom\";import ProtectedRoute from\"./ProtectedRoute\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditAvatarPopupOpen=_React$useState2[0],setIsEditAvatarPopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isEditProfilePopupOpen=_React$useState4[0],setIsEditProfilePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isAddPlacePopupOpen=_React$useState6[0],setIsAddPlacePopupOpen=_React$useState6[1];var _React$useState7=React.useState(null),_React$useState8=_slicedToArray(_React$useState7,2),selectedCard=_React$useState8[0],setCard=_React$useState8[1];var _React$useState9=React.useState({name:'',about:'',avatar:''}),_React$useState10=_slicedToArray(_React$useState9,2),currentUser=_React$useState10[0],setCurrentUser=_React$useState10[1];var _React$useState11=React.useState([]),_React$useState12=_slicedToArray(_React$useState11,2),cards=_React$useState12[0],setCards=_React$useState12[1];//константы для регистрации, авторизации\nvar _React$useState13=React.useState({email:'',password:''}),_React$useState14=_slicedToArray(_React$useState13,2),data=_React$useState14[0],setData=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),loggedIn=_React$useState16[0],setLoggedIn=_React$useState16[1];//переход по ссылкам в шапке профиля регистрация-войти\nvar _useLocation=useLocation(),pathname=_useLocation.pathname;var history=useHistory();var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),isInfoTooltipOpen=_React$useState18[0],setInfoToolTipOpen=_React$useState18[1];var _React$useState19=React.useState(false),_React$useState20=_slicedToArray(_React$useState19,2),registerStatus=_React$useState20[0],setRegisterStatus=_React$useState20[1];React.useEffect(function(){if(loggedIn){history.push('/');}},[history,loggedIn]);React.useEffect(function(){tokenCheck();},[]);function handleCardLike(card){// Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=card.likes.some(function(i){return i._id===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\nnewApi.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log('error',err);});}function handleCardDelete(card){newApi.deleteCard(card._id).then(function(){setCards(function(state){return state.filter(function(c){return c._id!==card._id;});});}).catch(function(err){console.log('error',err);});}React.useEffect(function(){newApi.getInitialCards().then(function(data){setCards(data);}).catch(function(err){console.log('error',err);});},[]);React.useEffect(function(){newApi.getProfileInfo().then(function(data){setCurrentUser(data);}).catch(function(err){console.log('error',err);});},[]);function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleCardClick(card){setCard(card);}function handleUpdateUser(user){newApi.editProfileInfo(user.name,user.about).then(function(data){setCurrentUser(data);}).catch(function(err){console.log('error',err);});}function handleUpdateAvatar(user){newApi.addNewAvatar(user.avatar).then(function(data){setCurrentUser(data);}).catch(function(err){console.log('error',err);});}function handleAddPlaceSubmit(picture){newApi.addNewCard(picture.name,picture.link).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));}).catch(function(err){console.log('error',err);});}function closeAllPopups(){setIsAddPlacePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsEditProfilePopupOpen(false);setCard(null);setInfoToolTipOpen(false);}React.useEffect(function(){// закрытие попапа кликом на esc\nfunction handleEscClose(evt){if(evt.key==='Escape'){closeAllPopups();}}window.addEventListener('keydown',handleEscClose);},[]);//методы для регистрации, авторизации\nfunction handleRegistration(_ref){var email=_ref.email,password=_ref.password;console.log({email:email,password:password});Auth.registration({email:email,password:password}).then(function(){setRegisterStatus(true);setInfoToolTipOpen(true);history.push('/signin');}).catch(function(){setRegisterStatus(false);setInfoToolTipOpen(true);});}function handleAuthorization(_ref2){var email=_ref2.email,password=_ref2.password;Auth.authorization({email:email,password:password}).then(function(data){console.log(data);localStorage.setItem('jwt',data.token);setLoggedIn(true);history.push('/');}).catch(function(err){console.log('error',err);});}var tokenCheck=function tokenCheck(){if(localStorage.getItem('jwt')){var jwt=localStorage.getItem('jwt');Auth.getContent(jwt).then(function(_ref3){var email=_ref3.email,password=_ref3.password;if(email){setLoggedIn(true);}}).catch(function(err){console.log('error',err);});}};function handleLogOut(){localStorage.removeItem('jwt');setData({email:'',password:''});setLoggedIn(false);history.push('/signin');}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsx(\"div\",{className:\"root\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(Header,{currentPath:pathname,onLogOut:handleLogOut,email:data.email}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,component:Main,onEditProfile:handleEditProfileClick,onEditAvatar:handleEditAvatarClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleCardDelete}),/*#__PURE__*/_jsx(Route,{path:\"/signin\",children:/*#__PURE__*/_jsx(Login,{data:data,onEnter:setData,onAutorization:handleAuthorization})}),/*#__PURE__*/_jsx(Route,{path:\"/signup\",children:/*#__PURE__*/_jsx(Register,{onRegister:handleRegistration})}),/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/signin\"})})]}),loggedIn&&/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(ImagePopup,{onClose:closeAllPopups,card:selectedCard}),/*#__PURE__*/_jsx(PopupWithForm,{name:\"popup-delete-card\",title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"popup__button popup__button_small popup__button-place\",children:\"\\u0414\\u0430\"})}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,isRegisterSuccessful:registerStatus,onClose:closeAllPopups})]})})});}export default App;","map":{"version":3,"sources":["/Users/oleg/Desktop/prakticum/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","Header","Main","Footer","ImagePopup","PopupWithForm","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Login","Register","InfoTooltip","Auth","newApi","CurrentUserContext","Route","Switch","Redirect","useLocation","useHistory","ProtectedRoute","App","useState","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","selectedCard","setCard","name","about","avatar","currentUser","setCurrentUser","cards","setCards","email","password","data","setData","loggedIn","setLoggedIn","pathname","history","isInfoTooltipOpen","setInfoToolTipOpen","registerStatus","setRegisterStatus","useEffect","push","tokenCheck","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeCardStatus","then","newCard","state","map","c","catch","err","console","log","handleCardDelete","deleteCard","filter","getInitialCards","getProfileInfo","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","handleUpdateUser","user","editProfileInfo","handleUpdateAvatar","addNewAvatar","handleAddPlaceSubmit","picture","addNewCard","link","closeAllPopups","handleEscClose","evt","key","window","addEventListener","handleRegistration","registration","handleAuthorization","authorization","localStorage","setItem","token","getItem","jwt","getContent","handleLogOut","removeItem"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport ImagePopup from \"./ImagePopup\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport * as Auth from \"../utils/Auth\";\nimport newApi from \"../utils/api\";\nimport {CurrentUserContext} from \"../contexts/CurrentUserContext\";\nimport {Route, Switch, Redirect, useLocation, useHistory} from \"react-router-dom\";\nimport ProtectedRoute from \"./ProtectedRoute\";\n\nfunction App() {\n\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [selectedCard, setCard] = React.useState(null);\n  const [currentUser, setCurrentUser] = React.useState({name: '', about: '', avatar: ''});\n  const [cards, setCards] = React.useState([]);\n\n  //константы для регистрации, авторизации\n  const [data, setData] = React.useState({\n    email: '',\n    password: ''\n  });\n\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  //переход по ссылкам в шапке профиля регистрация-войти\n  const {pathname} = useLocation();\n  const history = useHistory();\n  const [isInfoTooltipOpen, setInfoToolTipOpen] = React.useState(false);\n  const [registerStatus, setRegisterStatus] = React.useState(false);\n\n  React.useEffect(() => {\n    if (loggedIn) {\n      history.push('/');\n    }\n  }, [history, loggedIn])\n\n  React.useEffect(() => {\n    tokenCheck()\n  }, [])\n\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    newApi.changeLikeCardStatus(card._id, !isLiked)\n      .then((newCard) => {\n        setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n      })\n      .catch((err) => {\n        console.log('error', err)\n      })\n  }\n\n  function handleCardDelete(card) {\n    newApi.deleteCard(card._id)\n      .then(() => {\n        setCards((state) => state.filter((c) => c._id !== card._id));\n      })\n      .catch((err) => {\n        console.log('error', err)\n      })\n  }\n\n  React.useEffect(() => {\n    newApi.getInitialCards()\n      .then((data) => {\n        setCards(data)\n      })\n      .catch((err) => {\n        console.log('error', err)\n      })\n  }, [])\n\n  React.useEffect(() => {\n    newApi.getProfileInfo()\n      .then((data) => {\n        setCurrentUser(data);\n      })\n      .catch((err) => {\n        console.log('error', err)\n      })\n  }, []);\n\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleCardClick(card) {\n    setCard(card);\n  }\n\n  function handleUpdateUser(user) {\n    newApi.editProfileInfo(user.name, user.about)\n      .then((data) => {\n        setCurrentUser(data);\n      })\n      .catch((err) => {\n        console.log('error', err)\n      })\n  }\n\n  function handleUpdateAvatar(user) {\n    newApi.addNewAvatar(user.avatar)\n      .then((data) => {\n        setCurrentUser(data);\n      })\n      .catch((err) => {\n        console.log('error', err)\n      })\n  }\n\n  function handleAddPlaceSubmit(picture) {\n    newApi.addNewCard(picture.name, picture.link)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n      })\n      .catch((err) => {\n        console.log('error', err)\n      })\n  }\n\n  function closeAllPopups() {\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setCard(null)\n    setInfoToolTipOpen(false);\n  }\n\n  React.useEffect(() => {\n    // закрытие попапа кликом на esc\n    function handleEscClose(evt) {\n      if (evt.key === 'Escape') {\n        closeAllPopups();\n      }\n    }\n\n    window.addEventListener('keydown', handleEscClose);\n  }, [])\n\n  //методы для регистрации, авторизации\n  function handleRegistration({email, password}) {\n    console.log({email, password})\n    Auth.registration({email, password})\n      .then(() => {\n        setRegisterStatus(true)\n        setInfoToolTipOpen(true);\n        history.push('/signin')\n      })\n      .catch(() => {\n        setRegisterStatus(false)\n        setInfoToolTipOpen(true);\n      })\n  }\n\n  function handleAuthorization({email, password}) {\n    Auth.authorization({email, password})\n      .then((data) => {\n        console.log(data)\n        localStorage.setItem('jwt', data.token);\n        setLoggedIn(true);\n        history.push('/');\n      })\n      .catch((err) => {\n        console.log('error', err)\n      })\n  }\n\n  const tokenCheck = () => {\n    if (localStorage.getItem('jwt')) {\n      let jwt = localStorage.getItem('jwt');\n      Auth.getContent(jwt)\n        .then(({email, password}) => {\n          if (email) {\n            setLoggedIn(true);\n          }\n        })\n        .catch((err) => {\n          console.log('error', err)\n        })\n    }\n  }\n\n  function handleLogOut() {\n    localStorage.removeItem('jwt');\n    setData({\n      email: '',\n      password: ''\n    });\n    setLoggedIn(false);\n    history.push('/signin');\n  }\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"root\">\n        <div className=\"page\">\n          <Header currentPath={pathname}\n                  onLogOut={handleLogOut}\n                  email={data.email}\n          />\n          <Switch>\n            <ProtectedRoute\n              exact path=\"/\"\n              loggedIn={loggedIn}\n              component={Main}\n              onEditProfile={handleEditProfileClick}\n              onEditAvatar={handleEditAvatarClick}\n              onAddPlace={handleAddPlaceClick}\n              onCardClick={handleCardClick}\n              cards={cards}\n              onCardLike={handleCardLike}\n              onCardDelete={handleCardDelete}\n            />\n            <Route path=\"/signin\">\n              <Login\n                data={data}\n                onEnter={setData}\n                onAutorization={handleAuthorization}/>\n            </Route>\n            <Route path=\"/signup\">\n              <Register onRegister={handleRegistration}/>\n            </Route>\n            <Route>\n              {loggedIn ? (<Redirect to=\"/\"/>) : (<Redirect to=\"/signin\"/>)}\n            </Route>\n          </Switch>\n          {loggedIn && <Footer/>}\n          <EditProfilePopup isOpen={isEditProfilePopupOpen}\n                            onClose={closeAllPopups}\n                            onUpdateUser={handleUpdateUser}/>\n          <AddPlacePopup isOpen={isAddPlacePopupOpen}\n                         onClose={closeAllPopups}\n                         onAddPlace={handleAddPlaceSubmit}/>\n\n          <ImagePopup onClose={closeAllPopups} card={selectedCard}/>\n\n          <PopupWithForm name=\"popup-delete-card\" title=\"Вы уверены?\">\n            <button type=\"submit\" className=\"popup__button popup__button_small popup__button-place\">Да</button>\n          </PopupWithForm>\n\n          <EditAvatarPopup isOpen={isEditAvatarPopupOpen} onClose={closeAllPopups}\n                           onUpdateAvatar={handleUpdateAvatar}/>\n          <InfoTooltip isOpen={isInfoTooltipOpen}\n                       isRegisterSuccessful={registerStatus}\n                       onClose={closeAllPopups}/>\n        </div>\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}